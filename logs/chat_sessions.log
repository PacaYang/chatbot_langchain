2025-07-23 09:23:41 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 09:23:41 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 09:24:15 [INFO] Received session_id: None
2025-07-23 09:24:15 [INFO] Loaded session: None
2025-07-23 09:24:15 [INFO] New session created: 25f83aae-4301-4ba5-8ac9-7fee0ee0abd3
2025-07-23 09:24:15 [INFO] Session 25f83aae-4301-4ba5-8ac9-7fee0ee0abd3 received message: What is in your allergen spray?
2025-07-23 09:24:20 [INFO] 127.0.0.1 - - [23/Jul/2025 09:24:20] "POST /api/chat HTTP/1.1" 200 -
2025-07-23 09:34:01 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 09:34:01 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 09:34:07 [INFO] Received session_id: None
2025-07-23 09:34:07 [INFO] Loaded session: None
2025-07-23 09:34:07 [INFO] New session created: 5dfa1b6b-5ce7-47f9-99f5-ead8c92b38a2
2025-07-23 09:34:07 [INFO] Session 5dfa1b6b-5ce7-47f9-99f5-ead8c92b38a2 received message: What is in your allergen spray?
2025-07-23 09:34:13 [INFO] 127.0.0.1 - - [23/Jul/2025 09:34:13] "POST /api/chat HTTP/1.1" 200 -
2025-07-23 14:24:07 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 14:24:07 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 14:24:15 [INFO] Received session_id: None
2025-07-23 14:24:15 [INFO] Loaded session: None
2025-07-23 14:24:15 [INFO] New session created: c5060f1d-2b43-4d71-8af7-d0f6ea4a25c7
2025-07-23 14:24:15 [INFO] Session c5060f1d-2b43-4d71-8af7-d0f6ea4a25c7 received message: What is in your allergen spray?
2025-07-23 14:24:22 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 14:24:22 [INFO] 127.0.0.1 - - [23/Jul/2025 14:24:22] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 14:25:24 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 14:25:24 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 14:25:38 [INFO] Received session_id: None
2025-07-23 14:25:38 [INFO] Loaded session: None
2025-07-23 14:25:38 [INFO] New session created: 63c54f70-6c61-496e-a976-7ddf4e317b8c
2025-07-23 14:25:38 [INFO] Session 63c54f70-6c61-496e-a976-7ddf4e317b8c received message: What is in your allergen spray?
2025-07-23 14:25:47 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 14:25:47 [INFO] 127.0.0.1 - - [23/Jul/2025 14:25:47] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 14:26:09 [INFO] Received session_id: None
2025-07-23 14:26:09 [INFO] Loaded session: None
2025-07-23 14:26:09 [INFO] New session created: 953beffc-f019-45c1-abb3-f571d9618f1f
2025-07-23 14:26:09 [INFO] Session 953beffc-f019-45c1-abb3-f571d9618f1f received message: can you recommend a blog about cat adoption?
2025-07-23 14:26:12 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 14:26:12 [INFO] 127.0.0.1 - - [23/Jul/2025 14:26:12] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 14:27:26 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 14:27:26 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 14:27:29 [INFO] Received session_id: None
2025-07-23 14:27:29 [INFO] Loaded session: None
2025-07-23 14:27:29 [INFO] New session created: 66e04cf7-a4e1-448d-a691-48d5b0b57d65
2025-07-23 14:27:29 [INFO] Session 66e04cf7-a4e1-448d-a691-48d5b0b57d65 received message: can you recommend a blog about cat adoption?
2025-07-23 14:27:33 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 14:27:33 [INFO] 127.0.0.1 - - [23/Jul/2025 14:27:33] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 14:44:34 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 14:44:34 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 14:44:43 [INFO] Received session_id: None
2025-07-23 14:44:43 [INFO] Loaded session: None
2025-07-23 14:44:43 [INFO] New session created: 8d3fd780-5fac-4a2d-b5ec-dfdbb1b252bb
2025-07-23 14:44:43 [INFO] Session 8d3fd780-5fac-4a2d-b5ec-dfdbb1b252bb received message: can you recommend a product for me?
2025-07-23 14:44:45 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 14:44:45 [INFO] 127.0.0.1 - - [23/Jul/2025 14:44:45] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 14:51:36 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 14:51:36 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 14:52:01 [INFO] Received session_id: None
2025-07-23 14:52:01 [INFO] Loaded session: None
2025-07-23 14:52:01 [INFO] New session created: a0ca4b5f-cdf2-43a0-8b7a-2ff2c212ed17
2025-07-23 14:52:01 [INFO] Session a0ca4b5f-cdf2-43a0-8b7a-2ff2c212ed17 received message: can you recommend products?
2025-07-23 14:52:02 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 14:52:02 [INFO] 127.0.0.1 - - [23/Jul/2025 14:52:02] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 14:52:23 [INFO] Received session_id: None
2025-07-23 14:52:23 [INFO] Loaded session: None
2025-07-23 14:52:23 [INFO] New session created: 99e89f88-a6c5-478e-ba49-cb5ac57f10ec
2025-07-23 14:52:23 [INFO] Session 99e89f88-a6c5-478e-ba49-cb5ac57f10ec received message: something to treat allergy
2025-07-23 14:52:32 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 14:52:32 [INFO] 127.0.0.1 - - [23/Jul/2025 14:52:32] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 16:38:06 [INFO] Loading faiss with AVX512 support.
2025-07-23 16:38:06 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 16:38:06 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 16:38:07 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 16:38:27 [INFO] Loading faiss with AVX512 support.
2025-07-23 16:38:27 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 16:38:27 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 16:38:28 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 16:38:31 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 16:38:31 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 16:38:41 [INFO] Received session_id: None
2025-07-23 16:38:41 [INFO] Loaded session: None
2025-07-23 16:38:41 [INFO] New session created: ee5d1c2b-883c-480d-af22-d0b160c9fce2
2025-07-23 16:38:41 [INFO] Session ee5d1c2b-883c-480d-af22-d0b160c9fce2 received message: something to treat allergy
2025-07-23 16:38:48 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 16:38:48 [INFO] 127.0.0.1 - - [23/Jul/2025 16:38:48] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 16:41:22 [INFO] Loading faiss with AVX512 support.
2025-07-23 16:41:22 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 16:41:22 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 16:41:23 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 16:41:25 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 16:41:25 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 16:41:32 [INFO] Received session_id: None
2025-07-23 16:41:32 [INFO] Loaded session: None
2025-07-23 16:41:32 [INFO] New session created: 9a8b6616-ae20-46e9-a851-676651ca9e42
2025-07-23 16:41:32 [INFO] Session 9a8b6616-ae20-46e9-a851-676651ca9e42 received message: can you recommend products?
2025-07-23 16:41:33 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 16:41:33 [INFO] 127.0.0.1 - - [23/Jul/2025 16:41:33] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 16:41:37 [INFO] Received session_id: None
2025-07-23 16:41:37 [INFO] Loaded session: None
2025-07-23 16:41:37 [INFO] New session created: 33362a73-2e69-4220-a66b-defb9f3f4b2b
2025-07-23 16:41:37 [INFO] Session 33362a73-2e69-4220-a66b-defb9f3f4b2b received message: something to treat allergy
2025-07-23 16:41:39 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 16:41:39 [INFO] 127.0.0.1 - - [23/Jul/2025 16:41:39] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 16:46:58 [INFO] Loading faiss with AVX512 support.
2025-07-23 16:46:58 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 16:46:58 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 16:46:59 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 16:47:50 [INFO] Loading faiss with AVX512 support.
2025-07-23 16:47:50 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 16:47:50 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 16:47:51 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 16:48:47 [INFO] Loading faiss with AVX512 support.
2025-07-23 16:48:47 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 16:48:47 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 16:48:47 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 16:52:38 [INFO] Loading faiss with AVX512 support.
2025-07-23 16:52:38 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 16:52:38 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 16:52:38 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 16:53:15 [INFO] Loading faiss with AVX512 support.
2025-07-23 16:53:15 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 16:53:15 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 16:53:15 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 16:53:18 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 16:53:18 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 16:53:27 [INFO] Received session_id: None
2025-07-23 16:53:27 [INFO] Loaded session: None
2025-07-23 16:53:27 [INFO] New session created: 0db5be91-e932-4c7f-923b-3bb7609e8d4e
2025-07-23 16:53:27 [INFO] Session 0db5be91-e932-4c7f-923b-3bb7609e8d4e received message: can you recommend products?
2025-07-23 16:53:28 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 16:53:28 [INFO] 127.0.0.1 - - [23/Jul/2025 16:53:28] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 16:53:32 [INFO] Received session_id: None
2025-07-23 16:53:32 [INFO] Loaded session: None
2025-07-23 16:53:32 [INFO] New session created: 231416c9-fb35-4bf3-bd3c-091560e417f9
2025-07-23 16:53:32 [INFO] Session 231416c9-fb35-4bf3-bd3c-091560e417f9 received message: something to treat allergy
2025-07-23 16:53:35 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 16:53:35 [INFO] 127.0.0.1 - - [23/Jul/2025 16:53:35] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:01:44 [INFO] Loading faiss with AVX512 support.
2025-07-23 17:01:44 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 17:01:44 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 17:01:44 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 17:01:47 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 17:01:47 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 17:01:51 [INFO] Received session_id: None
2025-07-23 17:01:51 [INFO] Loaded session: None
2025-07-23 17:01:51 [INFO] New session created: dad45f2b-7e0d-47e7-b983-7ce9a6ad4af2
2025-07-23 17:01:51 [INFO] Session dad45f2b-7e0d-47e7-b983-7ce9a6ad4af2 received message: can you recommend products?
2025-07-23 17:01:53 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:01:53 [INFO] 127.0.0.1 - - [23/Jul/2025 17:01:53] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:02:07 [INFO] Received session_id: None
2025-07-23 17:02:07 [INFO] Loaded session: None
2025-07-23 17:02:07 [INFO] New session created: fe1272e2-fd76-4857-b6d9-3b254bc605bb
2025-07-23 17:02:07 [INFO] Session fe1272e2-fd76-4857-b6d9-3b254bc605bb received message: something to treat allergy
2025-07-23 17:02:11 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:02:11 [INFO] 127.0.0.1 - - [23/Jul/2025 17:02:11] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:06:07 [INFO] Loading faiss with AVX512 support.
2025-07-23 17:06:07 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 17:06:07 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 17:06:08 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 17:06:10 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 17:06:10 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 17:06:13 [INFO] Received session_id: None
2025-07-23 17:06:13 [INFO] Loaded session: None
2025-07-23 17:06:13 [INFO] New session created: 70e9a3dc-4f12-43cf-9a52-75b9451654e0
2025-07-23 17:06:13 [INFO] Session 70e9a3dc-4f12-43cf-9a52-75b9451654e0 received message: can you recommend products?
2025-07-23 17:06:14 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:06:14 [INFO] 127.0.0.1 - - [23/Jul/2025 17:06:14] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:06:16 [INFO] Received session_id: None
2025-07-23 17:06:16 [INFO] Loaded session: None
2025-07-23 17:06:16 [INFO] New session created: 411dfb1e-3c7a-43e0-8302-a4e2204f3e37
2025-07-23 17:06:16 [INFO] Session 411dfb1e-3c7a-43e0-8302-a4e2204f3e37 received message: something to treat allergy
2025-07-23 17:07:04 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:07:04 [INFO] 127.0.0.1 - - [23/Jul/2025 17:07:04] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:11:26 [INFO] Loading faiss with AVX512 support.
2025-07-23 17:11:26 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 17:11:26 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 17:11:27 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 17:11:31 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 17:11:31 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 17:11:36 [INFO] Received session_id: None
2025-07-23 17:11:36 [INFO] Loaded session: None
2025-07-23 17:11:36 [INFO] New session created: ae026823-9152-4729-bbc4-123670b4042a
2025-07-23 17:11:36 [INFO] Session ae026823-9152-4729-bbc4-123670b4042a received message: can you recommend products?
2025-07-23 17:11:37 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:11:37 [INFO] 127.0.0.1 - - [23/Jul/2025 17:11:37] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:11:40 [INFO] Received session_id: None
2025-07-23 17:11:40 [INFO] Loaded session: None
2025-07-23 17:11:40 [INFO] New session created: f5784b70-e4c9-4cb4-9c52-9cb995db9aed
2025-07-23 17:11:40 [INFO] Session f5784b70-e4c9-4cb4-9c52-9cb995db9aed received message: something to treat allergy
2025-07-23 17:12:31 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:12:31 [INFO] 127.0.0.1 - - [23/Jul/2025 17:12:31] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:12:40 [INFO] Loading faiss with AVX512 support.
2025-07-23 17:12:40 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 17:12:40 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 17:12:40 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 17:12:43 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 17:12:43 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 17:12:58 [INFO] Received session_id: None
2025-07-23 17:12:58 [INFO] Loaded session: None
2025-07-23 17:12:58 [INFO] New session created: 760b60de-ecce-49d7-a424-ca3fa29d8351
2025-07-23 17:12:58 [INFO] Session 760b60de-ecce-49d7-a424-ca3fa29d8351 received message: can you recommend products?
2025-07-23 17:13:00 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:13:00 [INFO] 127.0.0.1 - - [23/Jul/2025 17:13:00] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:13:01 [INFO] Received session_id: None
2025-07-23 17:13:01 [INFO] Loaded session: None
2025-07-23 17:13:01 [INFO] New session created: 97f42376-75b8-4d8e-a4d9-0b3fb95ae17d
2025-07-23 17:13:01 [INFO] Session 97f42376-75b8-4d8e-a4d9-0b3fb95ae17d received message: something to treat allergy
2025-07-23 17:13:06 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:13:06 [INFO] 127.0.0.1 - - [23/Jul/2025 17:13:06] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:14:12 [INFO] Loading faiss with AVX512 support.
2025-07-23 17:14:12 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 17:14:12 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 17:14:13 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 17:14:16 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 17:14:16 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 17:14:21 [INFO] Received session_id: None
2025-07-23 17:14:21 [INFO] Loaded session: None
2025-07-23 17:14:21 [INFO] New session created: 3d3548a4-aa04-4f9b-8d96-de892a7e790e
2025-07-23 17:14:21 [INFO] Session 3d3548a4-aa04-4f9b-8d96-de892a7e790e received message: something to treat allergy
2025-07-23 17:15:36 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:15:36 [INFO] 127.0.0.1 - - [23/Jul/2025 17:15:36] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:16:19 [INFO] Received session_id: None
2025-07-23 17:16:19 [INFO] Loaded session: None
2025-07-23 17:16:19 [INFO] New session created: a0ee0f91-030f-4758-9964-4120749e7c5d
2025-07-23 17:16:19 [INFO] Session a0ee0f91-030f-4758-9964-4120749e7c5d received message: something to treat cat allergens
2025-07-23 17:17:16 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:17:16 [INFO] 127.0.0.1 - - [23/Jul/2025 17:17:16] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:17:39 [INFO] Received session_id: None
2025-07-23 17:17:39 [INFO] Loaded session: None
2025-07-23 17:17:39 [INFO] New session created: dc47a975-53e8-44a5-804f-5949b2fda8a5
2025-07-23 17:17:39 [INFO] Session dc47a975-53e8-44a5-804f-5949b2fda8a5 received message: something to treat dog allergens
2025-07-23 17:17:50 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:17:50 [INFO] 127.0.0.1 - - [23/Jul/2025 17:17:50] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:22:20 [INFO] Loading faiss with AVX512 support.
2025-07-23 17:22:20 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 17:22:20 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 17:22:20 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 17:22:40 [INFO] Loading faiss with AVX512 support.
2025-07-23 17:22:40 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 17:22:40 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 17:22:41 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 17:22:43 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 17:22:43 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 17:22:48 [INFO] Received session_id: None
2025-07-23 17:22:48 [INFO] Loaded session: None
2025-07-23 17:22:48 [INFO] New session created: 357693f2-7069-4d6e-8864-ff44305080e5
2025-07-23 17:22:48 [INFO] Session 357693f2-7069-4d6e-8864-ff44305080e5 received message: something to treat dog allergens
2025-07-23 17:22:52 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:22:52 [INFO] 127.0.0.1 - - [23/Jul/2025 17:22:52] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:23:07 [INFO] Received session_id: None
2025-07-23 17:23:07 [INFO] Loaded session: None
2025-07-23 17:23:07 [INFO] New session created: 08c3eccc-d185-4abb-ad3c-894df61867bc
2025-07-23 17:23:07 [INFO] Session 08c3eccc-d185-4abb-ad3c-894df61867bc received message: can you recommend something to treat dog allergens
2025-07-23 17:23:12 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:23:12 [INFO] 127.0.0.1 - - [23/Jul/2025 17:23:12] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:24:50 [INFO] Loading faiss with AVX512 support.
2025-07-23 17:24:50 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 17:24:50 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 17:24:50 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 17:24:53 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 17:24:53 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 17:24:59 [INFO] Received session_id: None
2025-07-23 17:24:59 [INFO] Loaded session: None
2025-07-23 17:24:59 [INFO] New session created: 13ed8df9-c87d-4335-bea7-024724f2a62d
2025-07-23 17:24:59 [INFO] Session 13ed8df9-c87d-4335-bea7-024724f2a62d received message: can you recommend something to treat dog allergens
2025-07-23 17:25:03 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:25:03 [INFO] 127.0.0.1 - - [23/Jul/2025 17:25:03] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:38:02 [INFO] Loading faiss with AVX512 support.
2025-07-23 17:38:02 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 17:38:02 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 17:38:02 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 17:38:11 [INFO] Loading faiss with AVX512 support.
2025-07-23 17:38:11 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 17:38:11 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 17:38:12 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 17:38:14 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 17:38:14 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 17:38:17 [INFO] Received session_id: None
2025-07-23 17:38:17 [INFO] Loaded session: None
2025-07-23 17:38:17 [INFO] New session created: 53ceb22d-4a32-4439-8aa9-cc865e0b1132
2025-07-23 17:38:17 [INFO] Session 53ceb22d-4a32-4439-8aa9-cc865e0b1132 received message: can you recommend something to treat dog allergens
2025-07-23 17:38:21 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:38:21 [INFO] 127.0.0.1 - - [23/Jul/2025 17:38:21] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:40:36 [INFO] Loading faiss with AVX512 support.
2025-07-23 17:40:36 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-23 17:40:36 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-23 17:40:37 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-23 17:40:39 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-23 17:40:39 [INFO] [33mPress CTRL+C to quit[0m
2025-07-23 17:40:48 [INFO] Received session_id: None
2025-07-23 17:40:48 [INFO] Loaded session: None
2025-07-23 17:40:48 [INFO] New session created: 01447eb3-758c-4e0f-ad8c-17c1a54ee4c0
2025-07-23 17:40:48 [INFO] Session 01447eb3-758c-4e0f-ad8c-17c1a54ee4c0 received message: I am allergic to pollen
2025-07-23 17:40:53 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:40:53 [INFO] 127.0.0.1 - - [23/Jul/2025 17:40:53] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:41:11 [INFO] Received session_id: None
2025-07-23 17:41:11 [INFO] Loaded session: None
2025-07-23 17:41:11 [INFO] New session created: b5b0befa-fd55-45e9-969a-c343063a6144
2025-07-23 17:41:11 [INFO] Session b5b0befa-fd55-45e9-969a-c343063a6144 received message: I have a cat
2025-07-23 17:41:15 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:41:15 [INFO] 127.0.0.1 - - [23/Jul/2025 17:41:15] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:41:33 [INFO] Received session_id: None
2025-07-23 17:41:33 [INFO] Loaded session: None
2025-07-23 17:41:33 [INFO] New session created: 5e21bce6-7916-4c5d-b646-10b94638b6ba
2025-07-23 17:41:33 [INFO] Session 5e21bce6-7916-4c5d-b646-10b94638b6ba received message: I have a cat
2025-07-23 17:41:36 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:41:36 [INFO] 127.0.0.1 - - [23/Jul/2025 17:41:36] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:41:50 [INFO] Received session_id: None
2025-07-23 17:41:50 [INFO] Loaded session: None
2025-07-23 17:41:50 [INFO] New session created: 2d9ceb68-59de-4474-9546-f9a3e0473c77
2025-07-23 17:41:50 [INFO] Session 2d9ceb68-59de-4474-9546-f9a3e0473c77 received message: What did I say?
2025-07-23 17:41:51 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:41:51 [INFO] 127.0.0.1 - - [23/Jul/2025 17:41:51] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-23 17:42:09 [INFO] Received session_id: None
2025-07-23 17:42:09 [INFO] Loaded session: None
2025-07-23 17:42:09 [INFO] New session created: 57e6d4d8-b340-4d9a-b162-ccefe31ec21a
2025-07-23 17:42:09 [INFO] Session 57e6d4d8-b340-4d9a-b162-ccefe31ec21a received message: can you recommend products against allergens?
2025-07-23 17:42:13 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
           ~~~~~~~~~~~~~~~~~~~~~^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1212, in make_response
    raise TypeError(
    ...<3 lines>...
    )
TypeError: The view function for 'chat' did not return a valid response. The function either returned None or ended without a return statement.
2025-07-23 17:42:13 [INFO] 127.0.0.1 - - [23/Jul/2025 17:42:13] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 10:11:35 [INFO] Loading faiss with AVX512 support.
2025-07-24 10:11:35 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 10:11:35 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 10:11:36 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 10:11:41 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 10:11:41 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 10:11:50 [INFO] Received session_id: None
2025-07-24 10:11:50 [INFO] Loaded session: None
2025-07-24 10:11:50 [INFO] New session created: f6dd320a-fd47-476e-a11b-9e1f9ec9dd70
2025-07-24 10:11:50 [INFO] Session f6dd320a-fd47-476e-a11b-9e1f9ec9dd70 received message: can you recommend products against allergens?
2025-07-24 10:11:52 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 263, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 10:11:52 [INFO] 127.0.0.1 - - [24/Jul/2025 10:11:52] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 10:12:12 [INFO] Received session_id: None
2025-07-24 10:12:12 [INFO] Loaded session: None
2025-07-24 10:12:12 [INFO] New session created: 2095ec6c-1bab-4498-a5ad-5eb93f31e7f3
2025-07-24 10:12:12 [INFO] Session 2095ec6c-1bab-4498-a5ad-5eb93f31e7f3 received message: what is the capital city of USA?
2025-07-24 10:12:16 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 263, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 10:12:16 [INFO] 127.0.0.1 - - [24/Jul/2025 10:12:16] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 10:12:33 [INFO] Received session_id: None
2025-07-24 10:12:33 [INFO] Loaded session: None
2025-07-24 10:12:33 [INFO] New session created: 75ce827c-6b87-4fc7-9188-12e929637531
2025-07-24 10:12:33 [INFO] Session 75ce827c-6b87-4fc7-9188-12e929637531 received message: what makes pacagen different?
2025-07-24 10:12:37 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 263, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 10:12:37 [INFO] 127.0.0.1 - - [24/Jul/2025 10:12:37] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 10:13:25 [INFO] Loading faiss with AVX512 support.
2025-07-24 10:13:25 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 10:13:25 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 10:13:25 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 10:13:28 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 10:13:28 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 10:13:33 [INFO] Received session_id: None
2025-07-24 10:13:33 [INFO] Loaded session: None
2025-07-24 10:13:33 [INFO] New session created: b15a89e2-c046-4005-bb34-0aafa07ad0b0
2025-07-24 10:13:33 [INFO] Session b15a89e2-c046-4005-bb34-0aafa07ad0b0 received message: what makes pacagen different?
2025-07-24 10:13:36 [INFO] 127.0.0.1 - - [24/Jul/2025 10:13:36] "POST /api/chat HTTP/1.1" 200 -
2025-07-24 10:39:57 [INFO] Loading faiss with AVX512 support.
2025-07-24 10:39:57 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 10:39:57 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 10:39:57 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 10:40:00 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 10:40:00 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 10:53:40 [INFO] Received session_id: None
2025-07-24 10:53:40 [INFO] Loaded session: None
2025-07-24 10:53:40 [INFO] New session created: c0fb7a5b-596a-45f8-b4c3-bd07af5e82f2
2025-07-24 10:53:40 [INFO] Session c0fb7a5b-596a-45f8-b4c3-bd07af5e82f2 received message: I have a cat and I sometime sneeze around her. Am I allergic to her?
2025-07-24 10:53:44 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 262, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 10:53:44 [INFO] 127.0.0.1 - - [24/Jul/2025 10:53:44] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 10:54:23 [INFO] Received session_id: None
2025-07-24 10:54:23 [INFO] Loaded session: None
2025-07-24 10:54:23 [INFO] New session created: 95fdefe7-0c47-40d2-ba81-612b10aeb151
2025-07-24 10:54:23 [INFO] Session 95fdefe7-0c47-40d2-ba81-612b10aeb151 received message: I also have a dog. I am not sure which one actually causes my symptoms.
2025-07-24 10:54:28 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 262, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 10:54:28 [INFO] 127.0.0.1 - - [24/Jul/2025 10:54:28] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 10:55:14 [INFO] Received session_id: None
2025-07-24 10:55:14 [INFO] Loaded session: None
2025-07-24 10:55:14 [INFO] New session created: 1ff4ca38-a5ad-464c-ae7e-cb6a5003f65f
2025-07-24 10:55:14 [INFO] Session 1ff4ca38-a5ad-464c-ae7e-cb6a5003f65f received message: Sometimes I go outside but still feel itchy on my eyes.
2025-07-24 10:55:21 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 262, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 10:55:21 [INFO] 127.0.0.1 - - [24/Jul/2025 10:55:21] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 10:55:48 [INFO] Received session_id: None
2025-07-24 10:55:48 [INFO] Loaded session: None
2025-07-24 10:55:48 [INFO] New session created: f7e056e3-ec42-40c5-be3a-ab8725c59358
2025-07-24 10:55:48 [INFO] Session f7e056e3-ec42-40c5-be3a-ab8725c59358 received message: can you recommend some products to treat the symptoms?
2025-07-24 10:55:58 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 262, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 10:55:58 [INFO] 127.0.0.1 - - [24/Jul/2025 10:55:58] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 10:58:00 [INFO] Received session_id: None
2025-07-24 10:58:00 [INFO] Loaded session: None
2025-07-24 10:58:00 [INFO] New session created: 30070f94-2b0c-4204-b8b9-f11c896f6a20
2025-07-24 10:58:00 [INFO] Session 30070f94-2b0c-4204-b8b9-f11c896f6a20 received message: what pet do I have?
2025-07-24 10:58:03 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 262, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 10:58:03 [INFO] 127.0.0.1 - - [24/Jul/2025 10:58:03] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 12:14:00 [INFO] Loading faiss with AVX512 support.
2025-07-24 12:14:00 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 12:14:00 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 12:14:01 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 12:14:04 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 12:14:04 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 12:14:22 [INFO] Received session_id: None
2025-07-24 12:14:22 [INFO] Loaded session: None
2025-07-24 12:14:22 [INFO] New session created: 267c5df1-a536-4633-8179-62910bd9fb37
2025-07-24 12:14:22 [INFO] Session 267c5df1-a536-4633-8179-62910bd9fb37 received message: I have a cat and I am allergic. Can you recommend a product?
2025-07-24 12:14:30 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 265, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 12:14:30 [INFO] 127.0.0.1 - - [24/Jul/2025 12:14:30] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 12:26:48 [INFO] Loading faiss with AVX512 support.
2025-07-24 12:26:48 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 12:26:48 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 12:26:48 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 12:26:51 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 12:26:51 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 12:26:54 [INFO] Received session_id: None
2025-07-24 12:26:54 [INFO] Loaded session: None
2025-07-24 12:26:54 [INFO] New session created: dfa86d4e-ee32-4c62-956d-853b2ccd1507
2025-07-24 12:26:54 [INFO] Session dfa86d4e-ee32-4c62-956d-853b2ccd1507 received message: I have a cat and I am allergic. Can you recommend a product?
2025-07-24 12:27:01 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 263, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 12:27:01 [INFO] 127.0.0.1 - - [24/Jul/2025 12:27:01] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 12:58:44 [INFO] Loading faiss with AVX512 support.
2025-07-24 12:58:44 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 12:58:44 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 12:58:44 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 12:59:00 [INFO] Loading faiss with AVX512 support.
2025-07-24 12:59:00 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 12:59:00 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 12:59:01 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 12:59:04 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 12:59:04 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 12:59:15 [INFO] Received session_id: None
2025-07-24 12:59:15 [INFO] Loaded session: None
2025-07-24 12:59:15 [INFO] New session created: 2ebbf59f-3065-405e-968b-f23f29fe31de
2025-07-24 12:59:15 [INFO] Session 2ebbf59f-3065-405e-968b-f23f29fe31de received message: can you recommend some products to treat the symptoms?
2025-07-24 12:59:17 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 243, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 12:59:17 [INFO] 127.0.0.1 - - [24/Jul/2025 12:59:17] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 12:59:34 [INFO] Received session_id: None
2025-07-24 12:59:34 [INFO] Loaded session: None
2025-07-24 12:59:34 [INFO] New session created: 3be4b9a5-bbb1-4d59-a03f-ea8a542ad68c
2025-07-24 12:59:34 [INFO] Session 3be4b9a5-bbb1-4d59-a03f-ea8a542ad68c received message: I am allergic to cats
2025-07-24 13:00:38 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 243, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 13:00:38 [INFO] 127.0.0.1 - - [24/Jul/2025 13:00:38] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 13:04:27 [INFO] Received session_id: None
2025-07-24 13:04:27 [INFO] Loaded session: None
2025-07-24 13:04:27 [INFO] New session created: d6b3e056-8eb8-4f86-8447-0cba51defc9c
2025-07-24 13:04:27 [INFO] Session d6b3e056-8eb8-4f86-8447-0cba51defc9c received message: I am allergic to cats and want something to spray to alleviate symptoms
2025-07-24 13:05:42 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 243, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 13:05:42 [INFO] 127.0.0.1 - - [24/Jul/2025 13:05:42] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 13:09:01 [INFO] Loading faiss with AVX512 support.
2025-07-24 13:09:01 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 13:09:01 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 13:09:01 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 13:09:05 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 13:09:05 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 13:09:10 [INFO] Received session_id: None
2025-07-24 13:09:10 [INFO] Loaded session: None
2025-07-24 13:09:10 [INFO] New session created: 59228ebd-3a76-4f09-b22d-6f187064d9ae
2025-07-24 13:09:10 [INFO] Session 59228ebd-3a76-4f09-b22d-6f187064d9ae received message: I am allergic to cats and want something to spray to alleviate symptoms
2025-07-24 13:09:17 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 267, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 13:09:17 [INFO] 127.0.0.1 - - [24/Jul/2025 13:09:17] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 13:09:44 [INFO] Received session_id: None
2025-07-24 13:09:44 [INFO] Loaded session: None
2025-07-24 13:09:44 [INFO] New session created: 67afc81c-0cff-4b63-90fa-f289f58f1c50
2025-07-24 13:09:44 [INFO] Session 67afc81c-0cff-4b63-90fa-f289f58f1c50 received message: I am allergic to cats and want something to spray to alleviate symptoms. Can you recommend some products?
2025-07-24 13:09:52 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 267, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 13:09:52 [INFO] 127.0.0.1 - - [24/Jul/2025 13:09:52] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 13:15:18 [INFO] Loading faiss with AVX512 support.
2025-07-24 13:15:18 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 13:15:18 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 13:15:19 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 13:15:21 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 13:15:21 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 13:15:25 [INFO] Received session_id: None
2025-07-24 13:15:25 [INFO] Loaded session: None
2025-07-24 13:15:25 [INFO] New session created: c50f4f1a-d4cd-4402-b5c6-7f7c33f1c4f6
2025-07-24 13:15:25 [INFO] Session c50f4f1a-d4cd-4402-b5c6-7f7c33f1c4f6 received message: I am allergic to cats and want something to spray to alleviate symptoms. Can you recommend some products?
2025-07-24 13:15:33 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 268, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 13:15:33 [INFO] 127.0.0.1 - - [24/Jul/2025 13:15:33] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 13:15:54 [INFO] Received session_id: None
2025-07-24 13:15:54 [INFO] Loaded session: None
2025-07-24 13:15:54 [INFO] New session created: b17adcde-bbb5-43fa-bbc2-4e382786b906
2025-07-24 13:15:54 [INFO] Session b17adcde-bbb5-43fa-bbc2-4e382786b906 received message: I am allergic. Can you recommend some products?
2025-07-24 13:16:02 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 268, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 13:16:02 [INFO] 127.0.0.1 - - [24/Jul/2025 13:16:02] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 13:16:08 [INFO] Loading faiss with AVX512 support.
2025-07-24 13:16:08 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 13:16:08 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 13:16:08 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 13:16:12 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 13:16:12 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 13:16:16 [INFO] Received session_id: None
2025-07-24 13:16:16 [INFO] Loaded session: None
2025-07-24 13:16:16 [INFO] New session created: ac067778-a132-4444-92b4-43f5189c3ef2
2025-07-24 13:16:16 [INFO] Session ac067778-a132-4444-92b4-43f5189c3ef2 received message: I am allergic. Can you recommend some products?
2025-07-24 13:16:29 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 268, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 13:16:29 [INFO] 127.0.0.1 - - [24/Jul/2025 13:16:29] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 13:17:48 [INFO] Loading faiss with AVX512 support.
2025-07-24 13:17:48 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 13:17:48 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 13:17:49 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 13:17:52 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 13:17:52 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 13:17:57 [INFO] Received session_id: None
2025-07-24 13:17:57 [INFO] Loaded session: None
2025-07-24 13:17:57 [INFO] New session created: 7ff749f2-2ad3-4809-b345-8c7eb2382db7
2025-07-24 13:17:57 [INFO] Session 7ff749f2-2ad3-4809-b345-8c7eb2382db7 received message: I am allergic. Can you recommend some products?
2025-07-24 13:18:02 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 267, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 13:18:02 [INFO] 127.0.0.1 - - [24/Jul/2025 13:18:02] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 13:19:03 [INFO] Loading faiss with AVX512 support.
2025-07-24 13:19:03 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 13:19:03 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 13:19:04 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 13:19:06 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 13:19:06 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 13:19:19 [INFO] Received session_id: None
2025-07-24 13:19:19 [INFO] Loaded session: None
2025-07-24 13:19:19 [INFO] New session created: 0d5d7903-1c67-4b4c-8aba-632dcea8c097
2025-07-24 13:19:19 [INFO] Session 0d5d7903-1c67-4b4c-8aba-632dcea8c097 received message: I am allergic. Can you recommend some products?
2025-07-24 13:19:26 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 265, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 13:19:26 [INFO] 127.0.0.1 - - [24/Jul/2025 13:19:26] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:09:13 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:09:13 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:09:13 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:09:13 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:09:17 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:09:17 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:09:29 [INFO] Received session_id: None
2025-07-24 16:09:29 [INFO] Loaded session: None
2025-07-24 16:09:29 [INFO] New session created: e5b8057f-3cad-4926-8586-f14331a08aaa
2025-07-24 16:09:29 [INFO] Session e5b8057f-3cad-4926-8586-f14331a08aaa received message: can you recommend products against allergens?
2025-07-24 16:09:32 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 302, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_1JKGJM4uRq7jCx9zxyvefzDJ", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id '288ebf79-ddfa-ca75-15a2-6980846aa070'
During task with name 'product_recommendation' and id '626b59ed-c636-f7f6-8650-521d058e2e58'
2025-07-24 16:09:32 [INFO] 127.0.0.1 - - [24/Jul/2025 16:09:32] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:10:09 [INFO] Received session_id: None
2025-07-24 16:10:09 [INFO] Loaded session: None
2025-07-24 16:10:09 [INFO] New session created: e2396e2c-4581-4f3d-834d-3ffc89de892f
2025-07-24 16:10:09 [INFO] Session e2396e2c-4581-4f3d-834d-3ffc89de892f received message: I have a cat
2025-07-24 16:10:10 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 302, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 176, in query_or_respond
    response = llm_with_tools.invoke(state["messages"])
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 5431, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_1JKGJM4uRq7jCx9zxyvefzDJ", 'type': 'invalid_request_error', 'param': 'messages.[2].role', 'code': None}}
During task with name 'query_or_respond' and id 'a5bc07d9-945f-4661-fe8d-6b0cb04e53dc'
2025-07-24 16:10:10 [INFO] 127.0.0.1 - - [24/Jul/2025 16:10:10] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:11:04 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:11:04 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:11:04 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:11:04 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:11:07 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:11:07 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:11:10 [INFO] Received session_id: None
2025-07-24 16:11:10 [INFO] Loaded session: None
2025-07-24 16:11:10 [INFO] New session created: f10abcec-6c94-4897-9a7e-ab6ee8d537b3
2025-07-24 16:11:10 [INFO] Session f10abcec-6c94-4897-9a7e-ab6ee8d537b3 received message: I have a cat
2025-07-24 16:11:15 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 317, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 16:11:15 [INFO] 127.0.0.1 - - [24/Jul/2025 16:11:15] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:11:16 [INFO] Received session_id: None
2025-07-24 16:11:16 [INFO] Loaded session: None
2025-07-24 16:11:16 [INFO] New session created: b78017ee-da7f-483e-8d90-c92643264248
2025-07-24 16:11:16 [INFO] Session b78017ee-da7f-483e-8d90-c92643264248 received message: can you recommend products against allergens?
2025-07-24 16:11:23 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 302, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_Fq4Lu5c5x6aiQIMuR6rgHgIM", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id '39774fb7-bcbd-a5ca-2bbb-7d24b55b941c'
During task with name 'product_recommendation' and id '094ef38b-c52a-36ca-4f75-95d02c4d3a53'
2025-07-24 16:11:23 [INFO] 127.0.0.1 - - [24/Jul/2025 16:11:23] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:11:42 [INFO] Received session_id: None
2025-07-24 16:11:42 [INFO] Loaded session: None
2025-07-24 16:11:42 [INFO] New session created: 10edde40-850d-4ce3-8522-c417d4eea37d
2025-07-24 16:11:42 [INFO] Session 10edde40-850d-4ce3-8522-c417d4eea37d received message: I have a cat
2025-07-24 16:11:43 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 302, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 176, in query_or_respond
    response = llm_with_tools.invoke(state["messages"])
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 5431, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_Fq4Lu5c5x6aiQIMuR6rgHgIM", 'type': 'invalid_request_error', 'param': 'messages.[8].role', 'code': None}}
During task with name 'query_or_respond' and id '4e746cde-0953-5eee-746b-f9fd3528c6c8'
2025-07-24 16:11:43 [INFO] 127.0.0.1 - - [24/Jul/2025 16:11:43] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:19:26 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:19:26 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:19:26 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:19:27 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:19:30 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:19:30 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:19:32 [INFO] Received session_id: None
2025-07-24 16:19:32 [INFO] Loaded session: None
2025-07-24 16:19:32 [INFO] New session created: fb893022-a251-444f-85ae-94509d31f1d9
2025-07-24 16:19:32 [INFO] Session fb893022-a251-444f-85ae-94509d31f1d9 received message: I have a cat
2025-07-24 16:19:36 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 317, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 16:19:36 [INFO] 127.0.0.1 - - [24/Jul/2025 16:19:36] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:20:08 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:20:08 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:20:08 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:20:08 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:20:11 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:20:11 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:20:12 [INFO] Received session_id: None
2025-07-24 16:20:12 [INFO] Loaded session: None
2025-07-24 16:20:12 [INFO] New session created: 1395e543-bca1-4e18-8f5e-54e939bdfa5f
2025-07-24 16:20:12 [INFO] Session 1395e543-bca1-4e18-8f5e-54e939bdfa5f received message: I have a cat
2025-07-24 16:20:14 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 316, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 16:20:14 [INFO] 127.0.0.1 - - [24/Jul/2025 16:20:14] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:20:21 [INFO] Received session_id: None
2025-07-24 16:20:21 [INFO] Loaded session: None
2025-07-24 16:20:21 [INFO] New session created: 5b7a5260-10ac-4709-92cc-3f47021a067a
2025-07-24 16:20:21 [INFO] Session 5b7a5260-10ac-4709-92cc-3f47021a067a received message: I have a cat
2025-07-24 16:20:24 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 316, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 16:20:24 [INFO] 127.0.0.1 - - [24/Jul/2025 16:20:24] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:21:40 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:21:40 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:21:40 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:21:40 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:21:44 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:21:44 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:22:29 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:22:29 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:22:29 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:22:29 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:22:32 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:22:32 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:25:27 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:25:28 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:25:28 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:25:28 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:25:31 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:25:31 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:25:37 [INFO] Received session_id: None
2025-07-24 16:25:37 [INFO] Loaded session: None
2025-07-24 16:25:37 [INFO] New session created: d227c05a-0ecc-43b1-b15a-7d332d5e96e9
2025-07-24 16:25:37 [INFO] Session d227c05a-0ecc-43b1-b15a-7d332d5e96e9 received message: I have a cat
2025-07-24 16:25:40 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 322, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 16:25:40 [INFO] 127.0.0.1 - - [24/Jul/2025 16:25:40] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:26:35 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:26:35 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:26:35 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:26:36 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:26:39 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:26:39 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:26:39 [INFO] Received session_id: None
2025-07-24 16:26:39 [INFO] Loaded session: None
2025-07-24 16:26:39 [INFO] New session created: 4b24528f-ba7d-49cb-839e-e1a555d58ec5
2025-07-24 16:26:39 [INFO] Session 4b24528f-ba7d-49cb-839e-e1a555d58ec5 received message: I have a cat
2025-07-24 16:26:42 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 322, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 16:26:42 [INFO] 127.0.0.1 - - [24/Jul/2025 16:26:42] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:28:09 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:28:09 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:28:09 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:28:10 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:28:14 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:28:14 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:28:15 [INFO] Received session_id: None
2025-07-24 16:28:15 [INFO] Loaded session: None
2025-07-24 16:28:15 [INFO] New session created: afc84724-4009-4180-83ee-e3bb610293b4
2025-07-24 16:28:15 [INFO] Session afc84724-4009-4180-83ee-e3bb610293b4 received message: I have a cat
2025-07-24 16:28:18 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 318, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 16:28:18 [INFO] 127.0.0.1 - - [24/Jul/2025 16:28:18] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:31:26 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:31:26 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:31:26 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:31:26 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:31:37 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:31:37 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:31:37 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:31:37 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:31:39 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:31:39 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:31:41 [INFO] Received session_id: None
2025-07-24 16:31:41 [INFO] Loaded session: None
2025-07-24 16:31:41 [INFO] New session created: b21e4d42-8c7f-47ce-b9ba-a469f697c620
2025-07-24 16:31:41 [INFO] Session b21e4d42-8c7f-47ce-b9ba-a469f697c620 received message: I have a cat
2025-07-24 16:31:43 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 318, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 16:31:43 [INFO] 127.0.0.1 - - [24/Jul/2025 16:31:43] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:32:35 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:32:35 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:32:35 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:32:36 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:32:39 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:32:39 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:32:42 [INFO] Received session_id: None
2025-07-24 16:32:42 [INFO] Loaded session: None
2025-07-24 16:32:42 [INFO] New session created: bc4b1937-ee14-436a-89b1-a6ed0a1b04c9
2025-07-24 16:32:42 [INFO] Session bc4b1937-ee14-436a-89b1-a6ed0a1b04c9 received message: I have a cat
2025-07-24 16:32:43 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 318, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 16:32:43 [INFO] 127.0.0.1 - - [24/Jul/2025 16:32:43] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:32:47 [INFO] Received session_id: None
2025-07-24 16:32:47 [INFO] Loaded session: None
2025-07-24 16:32:47 [INFO] New session created: 05ed5912-6e48-4057-b780-cac791ff721a
2025-07-24 16:32:47 [INFO] Session 05ed5912-6e48-4057-b780-cac791ff721a received message: I have a cat
2025-07-24 16:32:49 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 318, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 16:32:49 [INFO] 127.0.0.1 - - [24/Jul/2025 16:32:49] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:37:23 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:37:23 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:37:23 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:37:24 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:37:29 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:37:29 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:37:32 [INFO] Received session_id: None
2025-07-24 16:37:32 [INFO] Loaded session: None
2025-07-24 16:37:32 [INFO] New session created: 111be351-37af-47b5-ab3c-2f457319293d
2025-07-24 16:37:32 [INFO] Session 111be351-37af-47b5-ab3c-2f457319293d received message: can you recommend products against allergens?
2025-07-24 16:37:33 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 300, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_MwolXIIc9aXfSCwtD7bwOI2K", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id 'e9337c9d-f11c-0e40-69e5-4c01fe844fde'
During task with name 'product_recommendation' and id '0ac35284-61e5-4880-8a70-8b3e2e2e44d3'
2025-07-24 16:37:33 [INFO] 127.0.0.1 - - [24/Jul/2025 16:37:33] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:38:57 [INFO] Received session_id: None
2025-07-24 16:38:57 [INFO] Loaded session: None
2025-07-24 16:38:57 [INFO] New session created: f9a3e19c-b753-4c7f-97d2-e83264dea7a4
2025-07-24 16:38:57 [INFO] Session f9a3e19c-b753-4c7f-97d2-e83264dea7a4 received message: I have a cat
2025-07-24 16:38:58 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 300, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 176, in query_or_respond
    response = llm_with_tools.invoke(state["messages"])
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 5431, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_MwolXIIc9aXfSCwtD7bwOI2K", 'type': 'invalid_request_error', 'param': 'messages.[2].role', 'code': None}}
During task with name 'query_or_respond' and id '6b47858f-0d1d-e836-1526-0d9fa788340d'
2025-07-24 16:38:58 [INFO] 127.0.0.1 - - [24/Jul/2025 16:38:58] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:39:50 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:39:50 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:40:27 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:40:27 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:41:39 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:41:39 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:41:39 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:41:40 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:41:42 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:41:42 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:41:47 [INFO] Received session_id: None
2025-07-24 16:41:47 [INFO] Loaded session: None
2025-07-24 16:41:47 [INFO] New session created: f791a6f9-25e1-4744-af33-13ad0c51231b
2025-07-24 16:41:47 [INFO] Session f791a6f9-25e1-4744-af33-13ad0c51231b received message: I have a cat
2025-07-24 16:41:48 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 318, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 16:41:48 [INFO] 127.0.0.1 - - [24/Jul/2025 16:41:48] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:42:00 [INFO] Received session_id: None
2025-07-24 16:42:00 [INFO] Loaded session: None
2025-07-24 16:42:00 [INFO] New session created: b325931a-c7c2-4cc7-9179-66cfc377d0c0
2025-07-24 16:42:00 [INFO] Session b325931a-c7c2-4cc7-9179-66cfc377d0c0 received message: what is special about pacagen?
2025-07-24 16:42:06 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 318, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 16:42:06 [INFO] 127.0.0.1 - - [24/Jul/2025 16:42:06] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:44:21 [INFO] Received session_id: None
2025-07-24 16:44:21 [INFO] Loaded session: None
2025-07-24 16:44:21 [INFO] New session created: 4372d161-1917-4a22-b025-31b87e460b6c
2025-07-24 16:44:21 [INFO] Session 4372d161-1917-4a22-b025-31b87e460b6c received message: can you recommend products against allergens?
2025-07-24 16:44:22 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 301, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_GrzRgpe59EtESFnnwCspAYbh", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id 'b2c84635-9316-2926-f3f7-0e0e0ccecced'
During task with name 'product_recommendation' and id 'c9bf3575-11ca-4631-5302-4413e7e32ded'
2025-07-24 16:44:22 [INFO] 127.0.0.1 - - [24/Jul/2025 16:44:22] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 16:57:16 [INFO] Loading faiss with AVX512 support.
2025-07-24 16:57:16 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 16:57:16 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 16:57:16 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 16:57:19 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 16:57:19 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 16:57:24 [INFO] Received session_id: None
2025-07-24 16:57:24 [INFO] Loaded session: None
2025-07-24 16:57:24 [INFO] New session created: 3b4b62b2-b364-43b6-9aec-8df74a10888f
2025-07-24 16:57:24 [INFO] Session 3b4b62b2-b364-43b6-9aec-8df74a10888f received message: can you recommend products against allergens?
2025-07-24 16:57:26 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 301, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_Ug0tafYzkwWdyojoTWxdPtE6", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id '1194e25e-de37-e603-5196-965c1d48ba87'
During task with name 'product_recommendation' and id 'c01d65d6-dd0e-0b5d-8917-19f3ef681cee'
2025-07-24 16:57:26 [INFO] 127.0.0.1 - - [24/Jul/2025 16:57:26] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:00:26 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:00:26 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:00:26 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:00:26 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:00:28 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:00:28 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:00:29 [INFO] Received session_id: None
2025-07-24 17:00:29 [INFO] Loaded session: None
2025-07-24 17:00:29 [INFO] New session created: acc5fdba-68e3-4d01-a250-9644936564eb
2025-07-24 17:00:29 [INFO] Session acc5fdba-68e3-4d01-a250-9644936564eb received message: can you recommend products against allergens?
2025-07-24 17:00:30 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 303, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_g5EO4mHRpNQBDDd2UPN9lLSt", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id '0ebc4faa-a76a-7135-e5d1-b78f7f6c73ac'
During task with name 'product_recommendation' and id 'c2d1690a-b784-29ef-d8c5-fb4c42f3916a'
2025-07-24 17:00:30 [INFO] 127.0.0.1 - - [24/Jul/2025 17:00:30] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:02:14 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:02:14 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:02:14 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:02:15 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:02:17 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:02:17 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:02:17 [INFO] Received session_id: None
2025-07-24 17:02:17 [INFO] Loaded session: None
2025-07-24 17:02:17 [INFO] New session created: fd40d31a-b728-478e-b679-2a30b42655fa
2025-07-24 17:02:17 [INFO] Session fd40d31a-b728-478e-b679-2a30b42655fa received message: can you recommend products against allergens?
2025-07-24 17:02:18 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 303, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_VAHaieqA2ecGGo888ZiPOv6G", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id '74ff87d6-8f87-9cbd-2b45-4c9de992cebd'
During task with name 'product_recommendation' and id 'e2b99b66-9618-55a3-67f8-97acd03c7cd7'
2025-07-24 17:02:18 [INFO] 127.0.0.1 - - [24/Jul/2025 17:02:18] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:16:44 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:16:44 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:16:44 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:16:44 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:16:48 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:16:48 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:16:50 [INFO] Received session_id: None
2025-07-24 17:16:50 [INFO] Loaded session: None
2025-07-24 17:16:50 [INFO] New session created: e7d4f684-f729-433e-85ad-aa655d81da5c
2025-07-24 17:16:50 [INFO] Session e7d4f684-f729-433e-85ad-aa655d81da5c received message: can you recommend products against allergens?
2025-07-24 17:16:51 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 303, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_0TEw7OTuistnikwB1sLAE916", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id '3de1a6d3-0539-b6ac-5f44-1171376f6543'
During task with name 'product_recommendation' and id '132c8843-9ad0-8e69-6886-6e19dda3d746'
2025-07-24 17:16:51 [INFO] 127.0.0.1 - - [24/Jul/2025 17:16:51] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:17:48 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:17:48 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:17:48 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:17:48 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:17:50 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:17:50 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:17:51 [INFO] Received session_id: None
2025-07-24 17:17:51 [INFO] Loaded session: None
2025-07-24 17:17:51 [INFO] New session created: e12b8d64-d871-431d-b4e2-81c3835bada5
2025-07-24 17:17:51 [INFO] Session e12b8d64-d871-431d-b4e2-81c3835bada5 received message: can you recommend products against allergens?
2025-07-24 17:17:52 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 304, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_lPUWCRE1sAKglXeE76HS13IR", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id '6c510093-2338-3aab-bd1e-8d62097c6b1b'
During task with name 'product_recommendation' and id 'c509dbfd-e1a3-83b9-aa8f-0a4b95c3322d'
2025-07-24 17:17:52 [INFO] 127.0.0.1 - - [24/Jul/2025 17:17:52] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:18:51 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:18:51 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:18:51 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:18:52 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:18:56 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:18:56 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:18:57 [INFO] Received session_id: None
2025-07-24 17:18:57 [INFO] Loaded session: None
2025-07-24 17:18:57 [INFO] New session created: f9ee25e5-da41-474e-8ab0-16ad32b4214a
2025-07-24 17:18:57 [INFO] Session f9ee25e5-da41-474e-8ab0-16ad32b4214a received message: can you recommend products against allergens?
2025-07-24 17:18:58 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 305, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_Q1uvLsk7xxjSLy4gPVJ2rHZ5", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id '640fef3a-8b8b-3241-f643-c77a1b56a26a'
During task with name 'product_recommendation' and id 'd2784c78-4a95-0836-5c68-77eaffc27f2a'
2025-07-24 17:18:58 [INFO] 127.0.0.1 - - [24/Jul/2025 17:18:58] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:23:02 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:23:02 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:23:02 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:23:03 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:28:39 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:28:39 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:28:39 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:28:39 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:28:42 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:28:42 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:28:46 [INFO] Received session_id: None
2025-07-24 17:28:46 [INFO] Loaded session: None
2025-07-24 17:28:46 [INFO] New session created: b6d0d9ad-ccee-4f14-8d17-fe0068215997
2025-07-24 17:28:46 [INFO] Session b6d0d9ad-ccee-4f14-8d17-fe0068215997 received message: can you recommend products against allergens?
2025-07-24 17:28:48 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 304, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_0bv1aevX7YxsecyZjtjHLrvu", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id 'b14df914-f79b-95b3-13a3-44df6c150af1'
During task with name 'product_recommendation' and id '193c9fea-d103-1c06-4ec9-90efa3d6ada9'
2025-07-24 17:28:48 [INFO] 127.0.0.1 - - [24/Jul/2025 17:28:48] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:29:31 [INFO] Received session_id: None
2025-07-24 17:29:31 [INFO] Loaded session: None
2025-07-24 17:29:31 [INFO] New session created: cc5effc9-7c03-4b87-86f5-d80a42052b34
2025-07-24 17:29:31 [INFO] Session cc5effc9-7c03-4b87-86f5-d80a42052b34 received message: what is special about pacagen?
2025-07-24 17:29:31 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 304, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 179, in query_or_respond
    response = llm_with_tools.invoke(state["messages"])
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 5431, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_0bv1aevX7YxsecyZjtjHLrvu", 'type': 'invalid_request_error', 'param': 'messages.[2].role', 'code': None}}
During task with name 'query_or_respond' and id '0faabb65-9c33-f000-9be0-6116e69f0529'
2025-07-24 17:29:31 [INFO] 127.0.0.1 - - [24/Jul/2025 17:29:31] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:29:42 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:29:42 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:29:42 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:29:43 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:29:45 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:29:45 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:29:46 [INFO] Received session_id: None
2025-07-24 17:29:46 [INFO] Loaded session: None
2025-07-24 17:29:46 [INFO] New session created: 6275d235-0459-4b3d-94e0-bb00e94528d8
2025-07-24 17:29:46 [INFO] Session 6275d235-0459-4b3d-94e0-bb00e94528d8 received message: what is special about pacagen?
2025-07-24 17:29:52 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 321, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 17:29:52 [INFO] 127.0.0.1 - - [24/Jul/2025 17:29:52] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:31:34 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:31:34 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:31:34 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:31:34 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:31:37 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:31:37 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:31:39 [INFO] Received session_id: None
2025-07-24 17:31:39 [INFO] Loaded session: None
2025-07-24 17:31:39 [INFO] New session created: 0a492b60-1bb7-48bd-937f-9f06be68c281
2025-07-24 17:31:39 [INFO] Session 0a492b60-1bb7-48bd-937f-9f06be68c281 received message: what is special about pacagen?
2025-07-24 17:31:41 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 304, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_5xt9Qkg5ahPnYO7pCneWTswE", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id '8774a198-dc6c-c99d-8832-ade9ba48062e'
During task with name 'product_recommendation' and id '75a38bcc-3e04-1142-1419-28e3e9393b33'
2025-07-24 17:31:41 [INFO] 127.0.0.1 - - [24/Jul/2025 17:31:41] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:34:02 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:34:02 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:34:02 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:34:02 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:34:04 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:34:04 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:34:10 [INFO] Received session_id: None
2025-07-24 17:34:10 [INFO] Loaded session: None
2025-07-24 17:34:10 [INFO] New session created: 947805d0-8163-437f-ad49-9b7678ecd65d
2025-07-24 17:34:10 [INFO] Session 947805d0-8163-437f-ad49-9b7678ecd65d received message: what is special about pacagen?
2025-07-24 17:34:11 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 321, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 17:34:11 [INFO] 127.0.0.1 - - [24/Jul/2025 17:34:11] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:36:05 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:36:05 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:36:05 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:36:05 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:36:08 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:36:08 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:36:10 [INFO] Received session_id: None
2025-07-24 17:36:10 [INFO] Loaded session: None
2025-07-24 17:36:10 [INFO] New session created: 78533aca-efce-45c9-868b-61257bfb8388
2025-07-24 17:36:10 [INFO] Session 78533aca-efce-45c9-868b-61257bfb8388 received message: what is special about pacagen?
2025-07-24 17:36:11 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 322, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 17:36:11 [INFO] 127.0.0.1 - - [24/Jul/2025 17:36:11] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:36:44 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:36:44 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:36:44 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:36:44 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:36:47 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:36:47 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:36:50 [INFO] Received session_id: None
2025-07-24 17:36:50 [INFO] Loaded session: None
2025-07-24 17:36:50 [INFO] New session created: b590f8e5-0fbe-4b08-b98f-3a658b21f3c5
2025-07-24 17:36:50 [INFO] Session b590f8e5-0fbe-4b08-b98f-3a658b21f3c5 received message: can you recommend products against allergens?
2025-07-24 17:36:51 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 322, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 17:36:51 [INFO] 127.0.0.1 - - [24/Jul/2025 17:36:51] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:39:17 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:39:17 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:39:17 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:39:18 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:39:20 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:39:20 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:39:21 [INFO] Received session_id: None
2025-07-24 17:39:21 [INFO] Loaded session: None
2025-07-24 17:39:21 [INFO] New session created: cdf38258-0ea5-46c5-aaf2-3360cd3cefdc
2025-07-24 17:39:21 [INFO] Session cdf38258-0ea5-46c5-aaf2-3360cd3cefdc received message: can you recommend products against allergens?
2025-07-24 17:39:22 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 306, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_HELMBEyE0zDvlg9uXJKLf46p", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id '5f8e1e5c-a4b4-65a5-c3aa-12146192b85b'
During task with name 'product_recommendation' and id '23cd4e51-8acd-2b3c-ff2b-a657e432fd50'
2025-07-24 17:39:22 [INFO] 127.0.0.1 - - [24/Jul/2025 17:39:22] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:48:01 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:48:01 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:48:01 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:48:02 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:48:06 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:48:06 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:48:14 [INFO] Received session_id: None
2025-07-24 17:48:14 [INFO] Loaded session: None
2025-07-24 17:48:14 [INFO] New session created: 801a6f46-489b-436d-95d0-5de486120790
2025-07-24 17:48:14 [INFO] Session 801a6f46-489b-436d-95d0-5de486120790 received message: what is special about pacagen?
2025-07-24 17:48:20 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 323, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 17:48:20 [INFO] 127.0.0.1 - - [24/Jul/2025 17:48:20] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:48:48 [INFO] Received session_id: None
2025-07-24 17:48:48 [INFO] Loaded session: None
2025-07-24 17:48:48 [INFO] New session created: 7f49da0f-7611-4532-bc2d-17202186c518
2025-07-24 17:48:48 [INFO] Session 7f49da0f-7611-4532-bc2d-17202186c518 received message: can you recommend products against allergens?
2025-07-24 17:48:49 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 306, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_kgJXlVZClr2nAZWXyMFISkMW", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id 'e005200a-4946-4175-bfd5-db65b527c095'
During task with name 'product_recommendation' and id '426494c1-0f9a-973e-28c6-5b6e4f022bf7'
2025-07-24 17:48:49 [INFO] 127.0.0.1 - - [24/Jul/2025 17:48:49] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:49:34 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:49:34 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:49:34 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:49:34 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:49:37 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:49:37 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:49:43 [INFO] Received session_id: None
2025-07-24 17:49:43 [INFO] Loaded session: None
2025-07-24 17:49:43 [INFO] New session created: dd447179-9712-4f2b-9094-a06c6b30698c
2025-07-24 17:49:43 [INFO] Session dd447179-9712-4f2b-9094-a06c6b30698c received message: can you recommend products against allergens?
2025-07-24 17:49:44 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 307, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"messages": [{"role": "user", "content": input_message}]},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        stream_mode="values",
        ^^^^^^^^^^^^^^^^^^^^^
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2843, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<8 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 81, in ask_or_recommend
    response = llm.invoke([SystemMessage(content=system_prompt)] + messages)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 378, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 963, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 782, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 1028, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 1130, in _generate
    response = self.client.create(**payload)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_utils/_utils.py", line 287, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/resources/chat/completions/completions.py", line 1087, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<43 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1249, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/openai/_base_client.py", line 1037, in request
    raise self._make_status_error_from_response(err.response) from None
openai.BadRequestError: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_JQGylEBCHhPATSkelWiY482I", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
During task with name 'ask_or_recommend' and id '05bd7ed9-33d0-846c-238f-3e43bb570a68'
During task with name 'product_recommendation' and id '455fd65f-3107-d724-8071-39dafe4a0891'
2025-07-24 17:49:44 [INFO] 127.0.0.1 - - [24/Jul/2025 17:49:44] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:53:35 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:53:35 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:53:35 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:53:36 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:53:38 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:53:38 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:53:40 [INFO] Received session_id: None
2025-07-24 17:53:40 [INFO] Loaded session: None
2025-07-24 17:53:40 [INFO] New session created: 930b2ffc-b78d-4b98-84fe-0e280d257f8a
2025-07-24 17:53:40 [INFO] Session 930b2ffc-b78d-4b98-84fe-0e280d257f8a received message: can you recommend products against allergens?
2025-07-24 17:53:43 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 323, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 17:53:43 [INFO] 127.0.0.1 - - [24/Jul/2025 17:53:43] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:53:54 [INFO] Received session_id: None
2025-07-24 17:53:54 [INFO] Loaded session: None
2025-07-24 17:53:54 [INFO] New session created: f9b2acb7-7e74-4282-981c-fba80dc06e93
2025-07-24 17:53:54 [INFO] Session f9b2acb7-7e74-4282-981c-fba80dc06e93 received message: what is special about pacagen?
2025-07-24 17:54:00 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 323, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 17:54:00 [INFO] 127.0.0.1 - - [24/Jul/2025 17:54:00] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:58:03 [INFO] Loading faiss with AVX512 support.
2025-07-24 17:58:03 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 17:58:03 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 17:58:04 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 17:58:07 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 17:58:07 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 17:58:10 [INFO] Received session_id: None
2025-07-24 17:58:10 [INFO] Loaded session: None
2025-07-24 17:58:10 [INFO] New session created: 976587d2-03a7-462e-b1b5-868305ed9205
2025-07-24 17:58:10 [INFO] Session 976587d2-03a7-462e-b1b5-868305ed9205 received message: what is special about pacagen?
2025-07-24 17:58:14 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 323, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 17:58:14 [INFO] 127.0.0.1 - - [24/Jul/2025 17:58:14] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 17:58:36 [ERROR] Exception on /api/form [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 385, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/retry.py", line 87, in call_with_retry
    return do()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 386, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 797, in _connect
    raise err
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 781, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 337, in handle_form
    session = get_session(session_id)
  File "/home/pacayang/Documents/marketing/chatbot_langchain/src/bot_session.py", line 12, in get_session
    session_json = r.get(session_id)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/commands/core.py", line 1829, in get
    return self.execute_command("GET", name, keys=[name])
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/client.py", line 623, in execute_command
    return self._execute_command(*args, **options)
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/client.py", line 629, in _execute_command
    conn = self.connection or pool.get_connection()
                              ~~~~~~~~~~~~~~~~~~~^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/utils.py", line 191, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 1530, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 379, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 391, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.
2025-07-24 17:58:36 [INFO] 127.0.0.1 - - [24/Jul/2025 17:58:36] "[35m[1mPOST /api/form HTTP/1.1[0m" 500 -
2025-07-24 17:59:33 [INFO] Received session_id: None
2025-07-24 17:59:33 [INFO] Loaded session: None
2025-07-24 17:59:33 [INFO] New session created: 5e3de0c3-3c05-4607-8a81-a8c52a6ee233
2025-07-24 17:59:33 [INFO] Session 5e3de0c3-3c05-4607-8a81-a8c52a6ee233 received message: what is special about pacagen?
2025-07-24 17:59:38 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 323, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 17:59:38 [INFO] 127.0.0.1 - - [24/Jul/2025 17:59:38] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 18:00:03 [INFO] Received session_id: None
2025-07-24 18:00:03 [INFO] Loaded session: None
2025-07-24 18:00:03 [INFO] New session created: ac21423d-0e39-4d7c-aef3-ebef07d2e702
2025-07-24 18:00:03 [INFO] Session ac21423d-0e39-4d7c-aef3-ebef07d2e702 received message: I am allergic to cat
2025-07-24 18:00:06 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 323, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 18:00:06 [INFO] 127.0.0.1 - - [24/Jul/2025 18:00:06] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 18:01:10 [INFO] Received session_id: None
2025-07-24 18:01:10 [INFO] Loaded session: None
2025-07-24 18:01:10 [INFO] New session created: 73e2d55d-d405-4f88-881f-57b66cb1e2b8
2025-07-24 18:01:10 [INFO] Session 73e2d55d-d405-4f88-881f-57b66cb1e2b8 received message: I am allergic to cat. I want to remove cat allergens
2025-07-24 18:01:14 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 323, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 18:01:14 [INFO] 127.0.0.1 - - [24/Jul/2025 18:01:14] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 18:01:41 [INFO] Loading faiss with AVX512 support.
2025-07-24 18:01:41 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 18:01:41 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 18:01:41 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 18:01:44 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 18:01:44 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 18:02:29 [INFO] Received session_id: None
2025-07-24 18:02:29 [INFO] Loaded session: None
2025-07-24 18:02:29 [INFO] New session created: cb139244-55db-49ff-8698-b901fc99d1bb
2025-07-24 18:02:29 [INFO] Session cb139244-55db-49ff-8698-b901fc99d1bb received message: I am allergic to cat. I want to remove cat allergens
2025-07-24 18:02:33 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 321, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 18:02:33 [INFO] 127.0.0.1 - - [24/Jul/2025 18:02:33] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 18:02:52 [INFO] Received session_id: None
2025-07-24 18:02:52 [INFO] Loaded session: None
2025-07-24 18:02:52 [INFO] New session created: a4702c71-6dcb-413a-b79d-fee213c4ee1d
2025-07-24 18:02:52 [INFO] Session a4702c71-6dcb-413a-b79d-fee213c4ee1d received message: I am looking for cat sprays
2025-07-24 18:02:55 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 321, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 18:02:55 [INFO] 127.0.0.1 - - [24/Jul/2025 18:02:55] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 18:06:20 [INFO] Loading faiss with AVX512 support.
2025-07-24 18:06:20 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 18:06:20 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 18:06:21 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 18:06:24 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 18:06:24 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 18:06:26 [INFO] Received session_id: None
2025-07-24 18:06:26 [INFO] Loaded session: None
2025-07-24 18:06:26 [INFO] New session created: fd200d1a-49dc-44ad-8f91-46fb509376ff
2025-07-24 18:06:26 [INFO] Session fd200d1a-49dc-44ad-8f91-46fb509376ff received message: I am looking for cat sprays
2025-07-24 18:06:30 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 322, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 18:06:30 [INFO] 127.0.0.1 - - [24/Jul/2025 18:06:30] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 18:08:09 [INFO] Loading faiss with AVX512 support.
2025-07-24 18:08:09 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 18:08:09 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 18:08:09 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 18:08:11 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 18:08:11 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 18:08:15 [INFO] Received session_id: None
2025-07-24 18:08:15 [INFO] Loaded session: None
2025-07-24 18:08:15 [INFO] New session created: 51269a80-a9bb-4e33-8fd2-01f9ea97d1a8
2025-07-24 18:08:15 [INFO] Session 51269a80-a9bb-4e33-8fd2-01f9ea97d1a8 received message: I am looking for cat sprays
2025-07-24 18:08:17 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 322, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 18:08:17 [INFO] 127.0.0.1 - - [24/Jul/2025 18:08:17] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 18:08:44 [INFO] Received session_id: None
2025-07-24 18:08:44 [INFO] Loaded session: None
2025-07-24 18:08:44 [INFO] New session created: cd2240cc-0601-4c44-8025-2265b2f8bd81
2025-07-24 18:08:44 [INFO] Session cd2240cc-0601-4c44-8025-2265b2f8bd81 received message: I am looking for cat sprays to remove allergens
2025-07-24 18:08:45 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 322, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 18:08:45 [INFO] 127.0.0.1 - - [24/Jul/2025 18:08:45] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 18:48:21 [INFO] Loading faiss with AVX512 support.
2025-07-24 18:48:21 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 18:48:21 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 18:48:22 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 18:49:33 [INFO] Loading faiss with AVX512 support.
2025-07-24 18:49:33 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 18:49:33 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 18:49:34 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 18:49:49 [INFO] Loading faiss with AVX512 support.
2025-07-24 18:49:49 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 18:49:49 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 18:49:50 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 18:49:52 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 18:49:52 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 18:50:17 [INFO] Received session_id: None
2025-07-24 18:50:17 [INFO] Loaded session: None
2025-07-24 18:50:17 [INFO] New session created: 61d5bdd5-6c9c-4c8a-9b6b-ada2bb80d983
2025-07-24 18:50:17 [INFO] Session 61d5bdd5-6c9c-4c8a-9b6b-ada2bb80d983 received message: I am allergic. Can you recommend some products?
2025-07-24 18:50:21 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 304, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 18:50:21 [INFO] 127.0.0.1 - - [24/Jul/2025 18:50:21] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 18:53:57 [INFO] Loading faiss with AVX512 support.
2025-07-24 18:53:57 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-24 18:53:57 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-24 18:53:58 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-24 18:54:00 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-24 18:54:00 [INFO] [33mPress CTRL+C to quit[0m
2025-07-24 18:54:02 [INFO] Received session_id: None
2025-07-24 18:54:02 [INFO] Loaded session: None
2025-07-24 18:54:02 [INFO] New session created: 690a41c7-8fcc-46ef-b88a-80ef945bdcd4
2025-07-24 18:54:02 [INFO] Session 690a41c7-8fcc-46ef-b88a-80ef945bdcd4 received message: I am allergic. Can you recommend some products?
2025-07-24 18:54:04 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 302, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 18:54:04 [INFO] 127.0.0.1 - - [24/Jul/2025 18:54:04] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 19:00:18 [INFO] Received session_id: None
2025-07-24 19:00:18 [INFO] Loaded session: None
2025-07-24 19:00:18 [INFO] New session created: 37d1eed7-4b51-4983-a19a-3ccd386d4c9b
2025-07-24 19:00:18 [INFO] Session 37d1eed7-4b51-4983-a19a-3ccd386d4c9b received message: what is special about pacagen
2025-07-24 19:00:25 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 302, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type AIMessage is not JSON serializable
2025-07-24 19:00:25 [INFO] 127.0.0.1 - - [24/Jul/2025 19:00:25] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-24 19:00:41 [INFO] Received session_id: None
2025-07-24 19:00:41 [INFO] Loaded session: None
2025-07-24 19:00:41 [INFO] New session created: 4cb0d890-166f-470f-822d-b3c6b55a1d15
2025-07-24 19:00:41 [INFO] Session 4cb0d890-166f-470f-822d-b3c6b55a1d15 received message: can you recommend some products
2025-07-24 19:00:55 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 302, in chat
    return jsonify({
        "response": response,
        "session_id": session_id,
        "new_session": new_session
    })
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
       ~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
           ~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
          ~~~~~~^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/json/encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type ToolMessage is not JSON serializable
2025-07-24 19:00:55 [INFO] 127.0.0.1 - - [24/Jul/2025 19:00:55] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 09:45:20 [INFO] Loading faiss with AVX512 support.
2025-07-25 09:45:20 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-25 09:45:20 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-25 09:45:21 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-25 09:45:26 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-25 09:45:26 [INFO] [33mPress CTRL+C to quit[0m
2025-07-25 09:45:29 [INFO] Received session_id: None
2025-07-25 09:45:29 [INFO] Loaded session: None
2025-07-25 09:45:29 [INFO] New session created: bd588ed9-f601-4b4b-ab32-a370b87969b7
2025-07-25 09:45:29 [INFO] Session bd588ed9-f601-4b4b-ab32-a370b87969b7 received message: can you recommend some products
2025-07-25 09:45:29 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 308, in chat
    step["messages"][-1].pretty_print()
    ~~~~^^^^^^^^^^^^
KeyError: 'messages'
2025-07-25 09:45:29 [INFO] 127.0.0.1 - - [25/Jul/2025 09:45:29] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 09:45:35 [INFO] Received session_id: None
2025-07-25 09:45:35 [INFO] Loaded session: None
2025-07-25 09:45:35 [INFO] New session created: 22db30d2-8be9-4717-bfb6-32b084a55629
2025-07-25 09:45:35 [INFO] Session 22db30d2-8be9-4717-bfb6-32b084a55629 received message: can you recommend some products
2025-07-25 09:45:35 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 308, in chat
    step["messages"][-1].pretty_print()
    ~~~~^^^^^^^^^^^^
KeyError: 'messages'
2025-07-25 09:45:35 [INFO] 127.0.0.1 - - [25/Jul/2025 09:45:35] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 09:46:06 [INFO] Received session_id: None
2025-07-25 09:46:06 [INFO] Loaded session: None
2025-07-25 09:46:06 [INFO] New session created: 6dcfecac-e1a9-45b6-a3b8-c227e6e4fa52
2025-07-25 09:46:06 [INFO] Session 6dcfecac-e1a9-45b6-a3b8-c227e6e4fa52 received message: can you recommend some products
2025-07-25 09:46:06 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 308, in chat
    step["messages"][-1].pretty_print()
    ~~~~^^^^^^^^^^^^
KeyError: 'messages'
2025-07-25 09:46:06 [INFO] 127.0.0.1 - - [25/Jul/2025 09:46:06] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 09:48:13 [INFO] Loading faiss with AVX512 support.
2025-07-25 09:48:13 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-25 09:48:13 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-25 09:48:13 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-25 09:48:16 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-25 09:48:16 [INFO] [33mPress CTRL+C to quit[0m
2025-07-25 09:48:17 [INFO] Received session_id: None
2025-07-25 09:48:17 [INFO] Loaded session: None
2025-07-25 09:48:17 [INFO] New session created: db8ab5d4-8083-432e-9bce-03ca837fcae3
2025-07-25 09:48:17 [INFO] Session db8ab5d4-8083-432e-9bce-03ca837fcae3 received message: can you recommend some products
2025-07-25 09:48:17 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 311, in chat
    step["messages"][-1].pretty_print()
    ~~~~^^^^^^^^^^^^
KeyError: 'messages'
2025-07-25 09:48:17 [INFO] 127.0.0.1 - - [25/Jul/2025 09:48:17] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 09:50:16 [INFO] Loading faiss with AVX512 support.
2025-07-25 09:50:16 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-25 09:50:16 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-25 09:50:16 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-25 09:50:19 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-25 09:50:19 [INFO] [33mPress CTRL+C to quit[0m
2025-07-25 09:50:23 [INFO] Received session_id: None
2025-07-25 09:50:23 [INFO] Loaded session: None
2025-07-25 09:50:23 [INFO] New session created: 365906d1-83f2-4398-94b7-895c3de323bc
2025-07-25 09:50:23 [INFO] Session 365906d1-83f2-4398-94b7-895c3de323bc received message: can you recommend some products
2025-07-25 09:50:23 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 311, in chat
    step["messages"][-1].pretty_print()
    ~~~~^^^^^^^^^^^^
KeyError: 'messages'
2025-07-25 09:50:23 [INFO] 127.0.0.1 - - [25/Jul/2025 09:50:23] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 09:51:57 [INFO] Loading faiss with AVX512 support.
2025-07-25 09:51:57 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-25 09:51:57 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-25 09:51:57 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-25 09:52:01 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-25 09:52:01 [INFO] [33mPress CTRL+C to quit[0m
2025-07-25 09:52:09 [INFO] Received session_id: None
2025-07-25 09:52:09 [INFO] Loaded session: None
2025-07-25 09:52:09 [INFO] New session created: 8a496570-abb4-456f-a7b9-21eba350ba58
2025-07-25 09:52:09 [INFO] Session 8a496570-abb4-456f-a7b9-21eba350ba58 received message: can you recommend some products
2025-07-25 09:52:09 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 311, in chat
    step.mState["messages"][-1].pretty_print()
    ^^^^^^^^^^^
AttributeError: 'dict' object has no attribute 'mState'
2025-07-25 09:52:09 [INFO] 127.0.0.1 - - [25/Jul/2025 09:52:09] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 09:53:26 [INFO] Loading faiss with AVX512 support.
2025-07-25 09:53:26 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-25 09:53:26 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-25 09:53:26 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-25 09:53:29 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-25 09:53:29 [INFO] [33mPress CTRL+C to quit[0m
2025-07-25 09:53:30 [INFO] Received session_id: None
2025-07-25 09:53:30 [INFO] Loaded session: None
2025-07-25 09:53:30 [INFO] New session created: 946d8d02-7ed7-4cde-b81d-2fa50ee25d87
2025-07-25 09:53:30 [INFO] Session 946d8d02-7ed7-4cde-b81d-2fa50ee25d87 received message: can you recommend some products
2025-07-25 09:53:30 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 304, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"rec_prod": rec_prod,
        ^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 165, in query_or_respond
    response = llm_with_tools.invoke(state.mState["messages"])
                                     ^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute 'mState'
During task with name 'query_or_respond' and id 'ee2433a2-07a9-ce4e-059d-c23e03ea0ccb'
2025-07-25 09:53:30 [INFO] 127.0.0.1 - - [25/Jul/2025 09:53:30] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 09:56:14 [INFO] Loading faiss with AVX512 support.
2025-07-25 09:56:14 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-25 09:56:14 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-25 09:56:14 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-25 09:56:18 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-25 09:56:18 [INFO] [33mPress CTRL+C to quit[0m
2025-07-25 09:56:20 [INFO] Received session_id: None
2025-07-25 09:56:20 [INFO] Loaded session: None
2025-07-25 09:56:20 [INFO] New session created: 4fb8a907-455f-4640-8c60-76b328bf06eb
2025-07-25 09:56:20 [INFO] Session 4fb8a907-455f-4640-8c60-76b328bf06eb received message: can you recommend some products
2025-07-25 09:56:20 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 304, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"rec_prod": rec_prod,
        ^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 165, in query_or_respond
    response = llm_with_tools.invoke(state.mState["messages"])
                                     ^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute 'mState'
During task with name 'query_or_respond' and id '03da2016-bc61-2a94-b9df-a8c6632017ea'
2025-07-25 09:56:20 [INFO] 127.0.0.1 - - [25/Jul/2025 09:56:20] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 09:58:05 [INFO] Loading faiss with AVX512 support.
2025-07-25 09:58:05 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-25 09:58:05 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-25 09:58:06 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-25 09:58:09 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-25 09:58:09 [INFO] [33mPress CTRL+C to quit[0m
2025-07-25 09:58:12 [INFO] Received session_id: None
2025-07-25 09:58:12 [INFO] Loaded session: None
2025-07-25 09:58:12 [INFO] New session created: c638e20e-c0e4-40a9-b548-a2a7cf8626ec
2025-07-25 09:58:12 [INFO] Session c638e20e-c0e4-40a9-b548-a2a7cf8626ec received message: can you recommend some products
2025-07-25 09:58:12 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 312, in chat
    step['mState']["messages"][-1].pretty_print()
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'dict' object has no attribute 'pretty_print'
2025-07-25 09:58:12 [INFO] 127.0.0.1 - - [25/Jul/2025 09:58:12] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 09:58:40 [INFO] Loading faiss with AVX512 support.
2025-07-25 09:58:40 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-25 09:58:40 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-25 09:58:40 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-25 09:58:42 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-25 09:58:42 [INFO] [33mPress CTRL+C to quit[0m
2025-07-25 09:58:51 [INFO] Received session_id: None
2025-07-25 09:58:51 [INFO] Loaded session: None
2025-07-25 09:58:51 [INFO] New session created: 1266d369-32ba-4b54-9a6e-e95aa75a17de
2025-07-25 09:58:51 [INFO] Session 1266d369-32ba-4b54-9a6e-e95aa75a17de received message: can you recommend some products
2025-07-25 09:58:53 [INFO] 127.0.0.1 - - [25/Jul/2025 09:58:53] "POST /api/chat HTTP/1.1" 200 -
2025-07-25 10:02:37 [INFO] Loading faiss with AVX512 support.
2025-07-25 10:02:37 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-25 10:02:37 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-25 10:02:37 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-25 10:02:40 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-25 10:02:40 [INFO] [33mPress CTRL+C to quit[0m
2025-07-25 10:03:21 [INFO] Received session_id: None
2025-07-25 10:03:21 [INFO] Loaded session: None
2025-07-25 10:03:21 [INFO] New session created: be44fede-13aa-403b-81ec-76745592f067
2025-07-25 10:03:21 [INFO] Session be44fede-13aa-403b-81ec-76745592f067 received message: I have 2 cats!
2025-07-25 10:03:25 [INFO] 127.0.0.1 - - [25/Jul/2025 10:03:25] "POST /api/chat HTTP/1.1" 200 -
2025-07-25 10:03:37 [INFO] Received session_id: None
2025-07-25 10:03:37 [INFO] Loaded session: None
2025-07-25 10:03:37 [INFO] New session created: 034eb7ff-656e-41ee-8149-be949ca3f4f7
2025-07-25 10:03:37 [INFO] Session 034eb7ff-656e-41ee-8149-be949ca3f4f7 received message: And I have 3 dogs!
2025-07-25 10:03:38 [INFO] 127.0.0.1 - - [25/Jul/2025 10:03:38] "POST /api/chat HTTP/1.1" 200 -
2025-07-25 10:03:53 [INFO] Received session_id: None
2025-07-25 10:03:53 [INFO] Loaded session: None
2025-07-25 10:03:53 [INFO] New session created: 5663c2f3-b25f-438a-b653-f170f390ca25
2025-07-25 10:03:53 [INFO] Session 5663c2f3-b25f-438a-b653-f170f390ca25 received message: How many pets do I have?
2025-07-25 10:03:57 [INFO] 127.0.0.1 - - [25/Jul/2025 10:03:57] "POST /api/chat HTTP/1.1" 200 -
2025-07-25 10:05:53 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 385, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/retry.py", line 87, in call_with_retry
    return do()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 386, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 797, in _connect
    raise err
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 781, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 269, in chat
    session = get_session(session_id)
  File "/home/pacayang/Documents/marketing/chatbot_langchain/src/bot_session.py", line 12, in get_session
    session_json = r.get(session_id)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/commands/core.py", line 1829, in get
    return self.execute_command("GET", name, keys=[name])
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/client.py", line 623, in execute_command
    return self._execute_command(*args, **options)
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/client.py", line 629, in _execute_command
    conn = self.connection or pool.get_connection()
                              ~~~~~~~~~~~~~~~~~~~^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/utils.py", line 191, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 1530, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 379, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 391, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.
2025-07-25 10:05:53 [INFO] 127.0.0.1 - - [25/Jul/2025 10:05:53] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 10:06:20 [INFO] Received session_id: None
2025-07-25 10:06:20 [INFO] Loaded session: None
2025-07-25 10:06:20 [INFO] New session created: 5e7af1a7-aa9d-4120-84a1-6a8504911814
2025-07-25 10:06:20 [INFO] Session 5e7af1a7-aa9d-4120-84a1-6a8504911814 received message: How many pets do I have?
2025-07-25 10:06:21 [INFO] 127.0.0.1 - - [25/Jul/2025 10:06:21] "POST /api/chat HTTP/1.1" 200 -
2025-07-25 10:06:25 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 385, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/retry.py", line 87, in call_with_retry
    return do()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 386, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 797, in _connect
    raise err
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 781, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 269, in chat
    session = get_session(session_id)
  File "/home/pacayang/Documents/marketing/chatbot_langchain/src/bot_session.py", line 12, in get_session
    session_json = r.get(session_id)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/commands/core.py", line 1829, in get
    return self.execute_command("GET", name, keys=[name])
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/client.py", line 623, in execute_command
    return self._execute_command(*args, **options)
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/client.py", line 629, in _execute_command
    conn = self.connection or pool.get_connection()
                              ~~~~~~~~~~~~~~~~~~~^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/utils.py", line 191, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 1530, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 379, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 391, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.
2025-07-25 10:06:25 [INFO] 127.0.0.1 - - [25/Jul/2025 10:06:25] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 10:07:28 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 385, in connect_check_health
    sock = self.retry.call_with_retry(
        lambda: self._connect(), lambda error: self.disconnect(error)
    )
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/retry.py", line 87, in call_with_retry
    return do()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 386, in <lambda>
    lambda: self._connect(), lambda error: self.disconnect(error)
            ~~~~~~~~~~~~~^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 797, in _connect
    raise err
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 781, in _connect
    sock.connect(socket_address)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 269, in chat
    session = get_session(session_id)
  File "/home/pacayang/Documents/marketing/chatbot_langchain/src/bot_session.py", line 12, in get_session
    session_json = r.get(session_id)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/commands/core.py", line 1829, in get
    return self.execute_command("GET", name, keys=[name])
           ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/client.py", line 623, in execute_command
    return self._execute_command(*args, **options)
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/client.py", line 629, in _execute_command
    conn = self.connection or pool.get_connection()
                              ~~~~~~~~~~~~~~~~~~~^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/utils.py", line 191, in wrapper
    return func(*args, **kwargs)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 1530, in get_connection
    connection.connect()
    ~~~~~~~~~~~~~~~~~~^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 379, in connect
    self.connect_check_health(check_health=True)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/redis/connection.py", line 391, in connect_check_health
    raise ConnectionError(self._error_message(e))
redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. Connection refused.
2025-07-25 10:07:28 [INFO] 127.0.0.1 - - [25/Jul/2025 10:07:28] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 12:39:14 [INFO] Loading faiss with AVX512 support.
2025-07-25 12:39:14 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-25 12:39:14 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-25 12:39:15 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-25 12:39:19 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-25 12:39:19 [INFO] [33mPress CTRL+C to quit[0m
2025-07-25 12:39:33 [INFO] Received session_id: 1234
2025-07-25 12:39:33 [INFO] Loaded session: None
2025-07-25 12:39:33 [INFO] New session created: 2ca0c895-03a6-457d-b47d-bd2e669fd1ca
2025-07-25 12:39:33 [INFO] Session 2ca0c895-03a6-457d-b47d-bd2e669fd1ca received message: How many pets do I have?
2025-07-25 12:39:33 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 305, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"rec_prod": rec_prod,
        ^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 165, in query_or_respond
    response = llm_with_tools.invoke(state['mState']["messages"])
                                     ~~~~~~~~~~~~~~~^^^^^^^^^^^^
TypeError: list indices must be integers or slices, not str
During task with name 'query_or_respond' and id 'e38de860-b41e-c4a0-83d6-0acb4eb17805'
2025-07-25 12:39:33 [INFO] 127.0.0.1 - - [25/Jul/2025 12:39:33] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
2025-07-25 12:40:09 [INFO] Loading faiss with AVX512 support.
2025-07-25 12:40:09 [INFO] Successfully loaded faiss with AVX512 support.
2025-07-25 12:40:09 [INFO] Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-07-25 12:40:09 [WARNING] USER_AGENT environment variable not set, consider setting it to identify your requests.
2025-07-25 12:40:13 [INFO] [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:3001
 * Running on http://192.168.1.198:3001
2025-07-25 12:40:13 [INFO] [33mPress CTRL+C to quit[0m
2025-07-25 12:40:16 [INFO] Received session_id: 1234
2025-07-25 12:40:16 [INFO] Loaded session: None
2025-07-25 12:40:16 [INFO] New session created: 4320803e-6db4-4af0-b6c4-951ba85be5ab
2025-07-25 12:40:16 [INFO] Session 4320803e-6db4-4af0-b6c4-951ba85be5ab received message: How many pets do I have?
2025-07-25 12:40:16 [ERROR] Exception on /api/chat [POST]
Traceback (most recent call last):
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 305, in chat
    for step in graph.stream(
                ~~~~~~~~~~~~^
        {"rec_prod": rec_prod,
        ^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        config=config,
        ^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Applications/miniconda3/envs/chatbot/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2533, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        [t for t in loop.tasks.values() if not t.writes],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        schedule_task=loop.accept_push,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/home/pacayang/Documents/marketing/chatbot_langchain/langchain_bot.py", line 165, in query_or_respond
    response = llm_with_tools.invoke(state['mState']["messages"])
                                     ~~~~~~~~~~~~~~~^^^^^^^^^^^^
TypeError: list indices must be integers or slices, not str
During task with name 'query_or_respond' and id '52923f75-f766-bd12-dc87-0c3abb75ce54'
2025-07-25 12:40:16 [INFO] 127.0.0.1 - - [25/Jul/2025 12:40:16] "[35m[1mPOST /api/chat HTTP/1.1[0m" 500 -
